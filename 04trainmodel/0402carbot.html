<!doctype html><html class=no-js lang=en-us prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta property="og:title" content="SpotBot Workshop"><meta property="og:type" content="website"><meta property="og:url" content><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=generator content="Hugo 0.72.0"><meta name=description content="My AWS Workshop"><meta name=author content="Jane Architect"><link rel="shortcut icon" href=https://a0.awsstatic.com/libra-css/images/site/fav/favicon.ico type=image/ico><link rel=icon href=https://a0.awsstatic.com/libra-css/images/site/fav/favicon.ico type=image/ico><title>车险理赔机器人模型训练 :: SpotBot Workshop</title><link href=../css/nucleus.css rel=stylesheet><link href=../css/fontawesome-all.min.css rel=stylesheet><link href=../css/hybrid.css rel=stylesheet><link href=../css/featherlight.min.css rel=stylesheet><link href=../css/perfect-scrollbar.min.css rel=stylesheet><link href=../css/auto-complete.css rel=stylesheet><link href=../css/atom-one-dark-reasonable.css rel=stylesheet><link href=../css/theme.css rel=stylesheet><link href=../css/hugo-theme.css rel=stylesheet><link href=../css/theme-aws.css rel=stylesheet><script src=../js/jquery-3.3.1.min.js></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}:not(pre)>code+span.copy-to-clipboard{display:none}</style></head><body data-url=/04trainmodel/0402carbot.html><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><div><a href=../ title="Go home"><img style=vertical-align:middle src=../images/logo.png height=70px></a></div></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=../js/lunr.min.js></script><script type=text/javascript src=../js/auto-complete.js></script><script type=text/javascript>var baseurl="";</script><script type=text/javascript src=../js/search.js></script></div><div class=highlightable><ul class=topics><li data-nav-id=/01introduction.html title=介绍 class=dd-item><a href=../01introduction.html><b>1.</b> 介绍
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/01introduction/100usecase.html title=使用场景 class=dd-item><a href=../01introduction/100usecase.html>使用场景
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/01introduction/200whyusespotbot.html title=数字化资产盘活机器人优点 class=dd-item><a href=../01introduction/200whyusespotbot.html>数字化资产盘活机器人优点
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/01introduction/300botype.html title=机器人类型 class=dd-item><a href=../01introduction/300botype.html>机器人类型
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/02architect.html title=系统架构 class=dd-item><a href=../02architect.html><b>2. </b>系统架构
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/02architect/0201overview.html title=架构概览 class=dd-item><a href=../02architect/0201overview.html><b>2.0</b>架构概览
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/02architect/0210component.html title=组件 class=dd-item><a href=../02architect/0210component.html><b>2.1</b> 组件
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/03deployment.html title=系统部署 class=dd-item><a href=../03deployment.html><b>3. </b>系统部署
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/03deployment/0301cloudformation.html title="Cloudformation 部署" class=dd-item><a href=../03deployment/0301cloudformation.html><b>3.1 </b>Cloudformation 部署
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/03deployment/0302verify.html title=环境验证 class=dd-item><a href=../03deployment/0302verify.html><b>3.2 </b>环境验证
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/03deployment/0302verify/100apigateway.html title=APIGateway class=dd-item><a href=../03deployment/0302verify/100apigateway.html>APIGateway
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/03deployment/0302verify/200lambda.html title=Lambda class=dd-item><a href=../03deployment/0302verify/200lambda.html>Lambda
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/03deployment/0302verify/500elasticsearch.html title=Elasticsearch class=dd-item><a href=../03deployment/0302verify/500elasticsearch.html>Elasticsearch
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li><li data-nav-id=/04trainmodel.html title=模型训练 class="dd-item
parent"><a href=../04trainmodel.html><b>4. </b>模型训练
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/04trainmodel/0401setup.html title=环境搭建 class=dd-item><a href=../04trainmodel/0401setup.html><b>4.1 </b>环境搭建
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/04trainmodel/0401setup/040101jupyter.html title=创建SageMaker笔记本实例 class=dd-item><a href=../04trainmodel/0401setup/040101jupyter.html><b>4.1 </b>创建SageMaker笔记本实例
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/04trainmodel/0402carbot.html title=车险理赔机器人模型训练 class="dd-item
parent
active"><a href=../04trainmodel/0402carbot.html><b>4.2 </b>车险理赔机器人模型训练
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/04trainmodel/0403semanticbot.html title=情感分类机器人模型训练 class=dd-item><a href=../04trainmodel/0403semanticbot.html><b>4.3</b> 情感分类机器人模型训练
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/05usebot.html title=使用机器人 class=dd-item><a href=../05usebot.html><b>5. </b>使用机器人
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/05usebot/0501ocrbot.html title=场景文字识别机器人 class=dd-item><a href=../05usebot/0501ocrbot.html><b>5.1 </b>场景文字识别机器人
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/05usebot/0501ocrbot/050101submitjob.html title=场景文字识别机器人-提交任务 class=dd-item><a href=../05usebot/0501ocrbot/050101submitjob.html><b>5.1.1 </b>场景文字识别机器人-提交任务
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/05usebot/0501ocrbot/050102checkresult.html title=场景文字识别机器人-测试结果 class=dd-item><a href=../05usebot/0501ocrbot/050102checkresult.html><b>5.1.2 </b>场景文字识别机器人-测试结果
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/05usebot/0502carbot.html title=车型识别机器人 class=dd-item><a href=../05usebot/0502carbot.html><b>5.2</b> 车型识别机器人
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/05usebot/0502carbot/050201submitjob.html title=车型识别机器人-提交任务 class=dd-item><a href=../05usebot/0502carbot/050201submitjob.html><b>5.2.1 </b>车型识别机器人-提交任务
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/05usebot/0502carbot/050202checkresult.html title=车型识别机器人-测试结果 class=dd-item><a href=../05usebot/0502carbot/050202checkresult.html><b>5.2.2 </b>车型识别机器人-测试结果
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/05usebot/0503semanticbot.html title=情感分析机器人 class=dd-item><a href=../05usebot/0503semanticbot.html><b>5.3</b> 情感分析机器人
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/05usebot/0503semanticbot/050301submitjob.html title=情感识别机器人-提交任务 class=dd-item><a href=../05usebot/0503semanticbot/050301submitjob.html><b>5.3.1 </b>情感识别机器人-提交任务
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/05usebot/0503semanticbot/050302checkresult.html title=情感识别机器人-测试结果 class=dd-item><a href=../05usebot/0503semanticbot/050302checkresult.html><b>5.3.2 </b>情感识别机器人-测试结果
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/05usebot/0504byob.html title="Bring Your Own Bot" class=dd-item><a href=../05usebot/0504byob.html><b>5.4 </b>Bring Your Own Bot
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/06deepdivebot.html title=DeepDive机器人 class=dd-item><a href=../06deepdivebot.html><b>6. </b>DeepDive机器人
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/06deepdivebot/060105checkstepfunction.html title="检查 StepFunction" class=dd-item><a href=../06deepdivebot/060105checkstepfunction.html><b>6.1</b>检查 StepFunction
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/06deepdivebot/0601010batch.html title="检查 AWS Batch" class=dd-item><a href=../06deepdivebot/0601010batch.html><b>6.2 </b>检查 AWS Batch
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/07cleanup.html title=资源清理 class=dd-item><a href=../07cleanup.html><b>7. </b>资源清理
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/07cleanup/0710sagemaker.html title="清理 SageMaker" class=dd-item><a href=../07cleanup/0710sagemaker.html><b>7.1 </b>清理 SageMaker
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/07cleanup/0720batch.html title="清理 Batch" class=dd-item><a href=../07cleanup/0720batch.html><b>7.2 </b>清理 Batch
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/07cleanup/0730stepfunction.html title="清理 StepFunction" class=dd-item><a href=../07cleanup/0730stepfunction.html><b>7.3 </b>清理 StepFunction
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/07cleanup/0740cleanup.html title="清理堆栈 SpotBot" class=dd-item><a href=../07cleanup/0740cleanup.html><b>7.4 </b>清理堆栈 SpotBot
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul><section id=prefooter><hr><ul><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i>Clear History</a></li></ul></section><section id=footer><left><h5 class=copyright>&copy; 2019 Amazon Web Services, Inc. or its Affiliates. All rights reserved.<h5></left></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fa fa-bars"></i></a></span><span class=links><a href=../>Spot Tagging Bot Workshop</a> > <a href=../04trainmodel.html>模型训练</a> > 车险理赔机器人模型训练</span></div></div></div><div id=chapter><div id=body-inner><h1>车险理赔机器人模型训练</h1><p>这里，我们来介绍一下如何使用sagemaker训练一个图片分类模型。共分为以下几步：</p><ul><li><a href=#%E5%BB%BA%E7%AB%8B%E7%AC%94%E8%AE%B0%E6%9C%AC>建立笔记本</a></li><li><a href=#%E6%9E%84%E5%BB%BA%E8%AE%AD%E7%BB%83%E4%BB%BB%E5%8A%A1>构建训练任务</a></li><li><a href=#%E6%9F%A5%E7%9C%8B%E7%BB%93%E6%9E%9C>查看结果</a></li><li><a href=#%E6%A8%A1%E5%9E%8B%E9%83%A8%E7%BD%B2>模型部署</a></li></ul><h3 id=建立笔记本>建立笔记本</h3><p>在本教程中，我们将使用图像分类任务来说明如何使用 AutoGluon 的 API。</p><p>我们将图像和相应的标签加载到 AutoGluon 中，并使用这些数据获取可对新图像进行分类的神经网络。这与传统的机器学习不同，我们需要手动定义神经网络，然后在训练过程中指定超参数。相反，只需对 AutoGluon 的拟合函数fit进行一次调用，AutoGluon 就会自动训练许多具有不同超参数配置的模型，并返回实现最高精度的模型。</p><p><strong>下载数据集</strong></p><p>在本教程中，我们将使<a href=http://ai.stanford.edu/~jkrause/cars/car_dataset.html>汽车图像数据集</a>, 该数据集包含 196 类汽车的 16,185 张图像。这些数据分为 8,144 张训练图像和 8,041 张测试图像，其中每个班级大致被分割为 50-50 分。类别通常是在品牌、模型、年份等级，例如 2012 年特斯拉 S 型或 2012 年宝马 M3 轿跑车。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>!wget http://imagenet.stanford.edu/internal/car196/cars_train.tgz
!wget http://imagenet.stanford.edu/internal/car196/cars_test.tgz
!wget http://ai.stanford.edu/~jkrause/cars/car_devkit.tgz
</code></pre></div><p><strong>数据格式转换</strong></p><p>解压缩数据集</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(<span style=color:#e6db74>&#34;devkit&#34;</span>):
    <span style=color:#960050;background-color:#1e0010>!</span>tar xf car_devkit<span style=color:#f92672>.</span>tgz
<span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(<span style=color:#e6db74>&#34;cars_train&#34;</span>):
    <span style=color:#960050;background-color:#1e0010>!</span>tar xf cars_train<span style=color:#f92672>.</span>tgz
<span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(<span style=color:#e6db74>&#34;cars_test&#34;</span>):
    <span style=color:#960050;background-color:#1e0010>!</span>tar xf cars_test<span style=color:#f92672>.</span>tgz
</code></pre></div><p>读取标注数据</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> scipy.io
cars_meta <span style=color:#f92672>=</span> scipy<span style=color:#f92672>.</span>io<span style=color:#f92672>.</span>loadmat(<span style=color:#e6db74>&#39;devkit/cars_meta.mat&#39;</span>)
</code></pre></div><p>转换数据格式</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>meta <span style=color:#f92672>=</span> [m[<span style=color:#ae81ff>0</span>] <span style=color:#66d9ef>for</span> m <span style=color:#f92672>in</span> cars_meta[<span style=color:#e6db74>&#39;class_names&#39;</span>][<span style=color:#ae81ff>0</span>]]
<span style=color:#66d9ef>for</span> m <span style=color:#f92672>in</span> meta:
    dirname <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;data/train/{}&#34;</span><span style=color:#f92672>.</span>format(m)
    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(dirname):
        os<span style=color:#f92672>.</span>mkdir(dirname)
    dirname <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;data/test/{}&#34;</span><span style=color:#f92672>.</span>format(m)
    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(dirname):
        os<span style=color:#f92672>.</span>mkdir(dirname)
</code></pre></div><p>可视化数据中的样本</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> cv2
<span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#f92672>as</span> plt
img <span style=color:#f92672>=</span> cv2<span style=color:#f92672>.</span>imread(<span style=color:#e6db74>&#34;data/train/Jeep_Patriot_SUV_2012/00086.jpg&#34;</span>)
img[:, :, (<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>)] <span style=color:#f92672>=</span> img[:, :, (<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>)]
ax <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>imshow(img)
</code></pre></div><h3 id=构建训练任务>构建训练任务</h3><p>安装AutoGluon工具包</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>!pip install -i https://pypi.tuna.tsinghua.edu.cn/simple autogluon<span style=color:#f92672>==</span>0.0.12 -t package
</code></pre></div><p>开始使用AutoGluon工具包，并定义任务</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> autogluon <span style=color:#f92672>as</span> ag
<span style=color:#f92672>from</span> autogluon <span style=color:#f92672>import</span> ImageClassification <span style=color:#66d9ef>as</span> task
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>dataset <span style=color:#f92672>=</span> task<span style=color:#f92672>.</span>Dataset(<span style=color:#e6db74>&#39;data/train&#39;</span>)
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>classifier <span style=color:#f92672>=</span> task<span style=color:#f92672>.</span>fit(dataset,
                      net<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ResNet50_v1b&#39;</span>,
                      batch_size<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span>,
                      epochs<span style=color:#f92672>=</span><span style=color:#ae81ff>20</span>,
                      ngpus_per_trial<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,
                      num_trials<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,
                      verbose<span style=color:#f92672>=</span>True)
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(<span style=color:#e6db74>&#34;models&#34;</span>):
    os<span style=color:#f92672>.</span>makedirs(<span style=color:#e6db74>&#34;models&#34;</span>)
classifier<span style=color:#f92672>.</span>save(<span style=color:#e6db74>&#34;models/resnet50_cars-0000.ag&#34;</span>)
</code></pre></div><h4 id=查看结果>查看结果</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;Top-1 val acc: </span><span style=color:#e6db74>%.3f</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>%</span> classifier<span style=color:#f92672>.</span>results[<span style=color:#e6db74>&#39;best_reward&#39;</span>])
<span style=color:#e6db74>&#34;Top-1 val acc: 0.724&#34;</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>image_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;cars_test/00003.jpg&#39;</span>
img <span style=color:#f92672>=</span> cv2<span style=color:#f92672>.</span>imread(image_path)
clsidx, prob, _ <span style=color:#f92672>=</span> classifier<span style=color:#f92672>.</span>predict(image_path)
<span style=color:#66d9ef>print</span>(clsidx<span style=color:#f92672>.</span>asscalar(), prob<span style=color:#f92672>.</span>asscalar(), classes[clsidx<span style=color:#f92672>.</span>asscalar()])
img[:, :, (<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>)] <span style=color:#f92672>=</span> img[:, :, (<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>)]
ax <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>imshow(img)
</code></pre></div><h3 id=模型部署>模型部署</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> sagemaker
<span style=color:#f92672>from</span> sagemaker <span style=color:#f92672>import</span> get_execution_role, local, Model, utils, fw_utils, s3

session <span style=color:#f92672>=</span> sagemaker<span style=color:#f92672>.</span>Session()
local_session <span style=color:#f92672>=</span> local<span style=color:#f92672>.</span>LocalSession()
bucket <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>default_bucket()
prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;sagemaker/autogluon-image-classification&#39;</span>
region <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>boto_region_name
role <span style=color:#f92672>=</span> get_execution_role()
client <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>boto_session<span style=color:#f92672>.</span>client(
    <span style=color:#e6db74>&#34;sts&#34;</span>, region_name<span style=color:#f92672>=</span>region, endpoint_url<span style=color:#f92672>=</span>utils<span style=color:#f92672>.</span>sts_regional_endpoint(region)
    )
account <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>get_caller_identity()[<span style=color:#e6db74>&#39;Account&#39;</span>]
ecr_uri_prefix <span style=color:#f92672>=</span> utils<span style=color:#f92672>.</span>get_ecr_image_uri_prefix(account, region)
registry_id <span style=color:#f92672>=</span> fw_utils<span style=color:#f92672>.</span>_registry_id(region, <span style=color:#e6db74>&#39;mxnet&#39;</span>, <span style=color:#e6db74>&#39;py3&#39;</span>, account, <span style=color:#e6db74>&#39;1.6.0&#39;</span>)
registry_uri <span style=color:#f92672>=</span> utils<span style=color:#f92672>.</span>get_ecr_image_uri_prefix(registry_id, region)

inference_algorithm_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;autogluon-sagemaker-inference&#39;</span>
algorithm_name <span style=color:#f92672>=</span> inference_algorithm_name
fullname<span style=color:#f92672>=</span>f<span style=color:#e6db74>&#34;{ecr_uri_prefix}/{algorithm_name}:latest&#34;</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>sagemaker_model <span style=color:#f92672>=</span> MXNetModel(model_data<span style=color:#f92672>=</span>model_data,
                             image<span style=color:#f92672>=</span>fullname,
                             role<span style=color:#f92672>=</span>role,
                             sagemaker_session<span style=color:#f92672>=</span>session,
                             py_version<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;py3&#39;</span>,
                             entry_point<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;docker/serve.py&#39;</span>,
                             framework_version<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;1.6.0&#39;</span>)
predictor <span style=color:#f92672>=</span> sagemaker_model<span style=color:#f92672>.</span>deploy(initial_instance_count<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>, instance_type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ml.m5.xlarge&#39;</span>)
</code></pre></div><footer class=footline></footer></div></div></div><div id=navigation><a class="nav nav-prev" href=../04trainmodel/0401setup/040101jupyter.html title=创建SageMaker笔记本实例><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=../04trainmodel/0403semanticbot.html title=情感分类机器人模型训练 style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=../js/clipboard.min.js></script><script src=../js/perfect-scrollbar.min.js></script><script src=../js/perfect-scrollbar.jquery.min.js></script><script src=../js/jquery.sticky.js></script><script src=../js/featherlight.min.js></script><script src=../js/html5shiv-printshiv.min.js></script><script src=../js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script src=../js/modernizr.custom-3.6.0.js></script><script src=../js/learn.js></script><script src=../js/hugo-learn.js></script><link href=../mermaid/mermaid.css rel=stylesheet><script src=../mermaid/mermaid.js></script><script>mermaid.initialize({startOnLoad:true});</script></body></html>